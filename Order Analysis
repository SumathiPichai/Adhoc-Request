select  A.shopperid, 
 min(orderdate) ,
 max(case when b2b.ShopperID is not null then 'Y' else 'N' end)  as B2B_customer
 ,SUM(case when rownumber = 1 then  order_amt  else null end ) as order_1
,SUM(case when rownumber = 2 then  order_amt  else null end ) as order_2
,SUM(case when rownumber = 3 then  order_amt  else null end ) as order_3
,SUM(case when rownumber = 4 then  order_amt  else null end ) as order_4
,SUM(case when rownumber = 5 then  order_amt  else null end ) as order_5
,SUM(case when rownumber = 6 then  order_amt  else null end ) as order_6
,SUM(case when rownumber = 7 then  order_amt  else null end ) as order_7
,SUM(case when rownumber = 8 then  order_amt  else null end ) as order_8
,SUM(case when rownumber = 9 then  order_amt  else null end ) as order_9
,SUM(case when rownumber = 10 then  order_amt  else null end ) as order_10
,SUM(case when rownumber = 11  then  order_amt  else null end ) as order_11
,SUM(case when rownumber = 12 then  order_amt  else null end ) as order_12
,SUM(case when rownumber = 13 then  order_amt  else null end ) as order_13
,SUM(case when rownumber = 14 then  order_amt  else null end ) as order_14
,SUM(case when rownumber = 15 then  order_amt  else null end ) as order_15
,SUM(case when rownumber = 16 then  order_amt  else null end ) as order_16
,SUM(case when rownumber = 17 then  order_amt  else null end ) as order_17
,SUM(case when rownumber = 18 then  order_amt  else null end ) as order_18
,SUM(case when rownumber = 19 then  order_amt  else null end ) as order_19
,SUM(case when rownumber = 20 then  order_amt  else null end ) as order_20
,SUM(case when rownumber = 21 then  order_amt  else null end ) as order_21
,SUM(case when rownumber = 22 then  order_amt  else null end ) as order_22
,SUM(case when rownumber = 23 then  order_amt  else null end ) as order_23
,SUM(case when rownumber = 24 then  order_amt  else null end ) as order_24
,SUM(case when rownumber = 25 then  order_amt  else null end ) as order_25
,SUM(case when rownumber = 26 then  order_amt  else null end ) as order_26
,SUM(case when rownumber = 27 then  order_amt  else null end ) as order_27
,SUM(case when rownumber = 28 then  order_amt  else null end ) as order_28
,SUM(case when rownumber = 29 then  order_amt  else null end ) as order_29
,SUM(case when rownumber = 30 then  order_amt  else null end ) as order_30
,SUM(case when rownumber = 31 then  order_amt  else null end ) as order_31
,SUM(case when rownumber = 32 then  order_amt  else null end ) as order_32
,SUM(case when rownumber = 33 then  order_amt  else null end ) as order_33
,SUM(case when rownumber = 34 then  order_amt  else null end ) as order_34
,SUM(case when rownumber = 35 then  order_amt  else null end ) as order_35
,SUM(case when rownumber = 36 then  order_amt  else null end ) as order_36
,SUM(case when rownumber = 37 then  order_amt  else null end ) as order_37
,SUM(case when rownumber = 38 then  order_amt  else null end ) as order_38
,SUM(case when rownumber = 39 then  order_amt  else null end ) as order_39
,SUM(case when rownumber = 40 then  order_amt  else null end ) as order_40
,SUM(case when rownumber = 41 then  order_amt  else null end ) as order_41
,SUM(case when rownumber = 42 then  order_amt  else null end ) as order_42
,SUM(case when rownumber = 43 then  order_amt  else null end ) as order_43
,SUM(case when rownumber = 44 then  order_amt  else null end ) as order_44
,SUM(case when rownumber = 45 then  order_amt  else null end ) as order_45
,SUM(case when rownumber = 46 then  order_amt  else null end ) as order_46
,SUM(case when rownumber = 47 then  order_amt  else null end ) as order_47
,SUM(case when rownumber = 48 then  order_amt  else null end ) as order_48
,SUM(case when rownumber = 49 then  order_amt  else null end ) as order_49
,SUM(case when rownumber = 50 then  order_amt  else null end ) as order_50
,SUM(case when rownumber = 51 then  order_amt  else null end ) as order_51
,SUM(case when rownumber = 52 then  order_amt  else null end ) as order_52
,SUM(case when rownumber > 52 then  order_amt  else null end ) as order_53
 from 
 
 
 ( 
 
 select shopperid ,    (total - deliveryfee ) as order_amt , orderdate , total , ROW_NUMBER() OVER (PARTITION BY shopperid order by orderdate asc) rownumber
 
   from PROD_EDW_SIF.MOR_SMKT_ORD_ORDER  ordr
   
   where 
   shopperid in (   
select shopper_id  
 from PROD_EDW_SIF.MOR_SMKT_STR_SHOPPER where end_date = date'2099-12-31' and record_deleted_flag = 0 
and cast( date_created  as date) >= date'2016-01-01' and cast( date_created  as date) <date'2017-01-01' 
)
and  Status not in ('C a n c e l l e d','Cancelled')
and   (total - deliveryfee ) <> 0.0000
and cast(ss_exp_tmstmp as date) =date'2099-12-31'

) A 
left join 
    PROD_EDW_SIF.MOR_SMKT_STR_SHOPPERB2B b2b
    on 
                b2b.end_date = date'2099-12-31' 
    and   b2b. shopperid  = A.shopperid 
    and  b2b.Record_Deleted_Flag   = 0 
 
 group by 1 
 order by 
 order_1
 ,order_2
 ,order_3
 ,order_4
 ,order_5
 ,order_6
 ,order_7
 ,order_8
 ,order_9
 ,order_10
 ,order_11
 ,order_12
 ,order_13
 ,order_14
 ,order_15
 ,order_16
 ,order_17
 ,order_18
 ,order_19
 ,order_20
 ,order_21
 ,order_22
 ,order_23
 ,order_24
 ,order_25
 ,order_26
 ,order_27
 ,order_28
 ,order_29
 ,order_30
 ,order_31
 ,order_32
 ,order_33
 ,order_34
 ,order_35
 ,order_36
 ,order_37
 ,order_38
 ,order_39
 ,order_40
 ,order_41
 ,order_42
 ,order_43
 ,order_44
 ,order_45
 ,order_46
 ,order_47
 ,order_48
 ,order_49
 ,order_50
 ,order_51
 ,order_52
 ,order_53
